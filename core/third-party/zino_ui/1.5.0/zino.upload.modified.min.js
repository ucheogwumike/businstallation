/*!
 * ZinoUI v1.5 (http://zinoui.com)
 * Copyright 2012-2015 Dimitar Ivanov. All Rights Reserved.
 * 
 * Zino UI commercial licenses may be obtained at http://zinoui.com/license
 * If you do not own a commercial license, this file shall be governed by the
 * GNU General Public License (GPL) version 3.
 * For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
 */
(function(c){function m(){this._defaults={url:"upload.php",method:"PUT",name:"file",label:"Upload",data:{},multiple:false,autoSubmit:true,change:null,submit:null,complete:null,progress:null}}function n(){this.boundary="------ZinoUI"+Math.ceil(Math.random()*9999999);this.data=[]}n.prototype={append:function(b,d){this.data.push([b,d]);return this},toString:function(){var b,d,e,f=this.boundary,a=[];b=0;for(d=this.data.length;b<d;b++){a.push(["--",f,"\r\n"].join(""));if(this.data[b][1].name){e=this.data[b][1];
a.push(['Content-Disposition: form-data; name="',this.data[b][0],'"; filename="',e.name,'"\r\n'].join(""));a.push(["Content-Type: ",e.type,"\r\n\r\n"].join(""));a.push([e.getAsBinary(),"\r\n"].join(""))}else{a.push(['Content-Disposition: form-data; name="',this.data[b][0],'";\r\n\r\n'].join(""));a.push([this.data[b][1],"\r\n"].join(""))}}a.push(["--",f,"--"].join(""));return a.join("")}};m.prototype={_attachUpload:function(b,d){if(this._getInst(b))return false;var e=c(b),f=this,a=this._newInst(e);
c.extend(a.settings,this._defaults,d);e.addClass("zui-upload").hover(function(){c(this).addClass("zui-upload-hover")},function(){c(this).removeClass("zui-upload-hover")});if(a.settings.label.length>0){a.$label=c("<span>").addClass("zui-upload-label").text(a.settings.label);a.$label.appendTo(e)}a.$form=c(['<form method="',a.settings.method,'" action="',a.settings.url,'" enctype="multipart/form-data" encoding="multipart/form-data"><input name="',a.settings.name,'"',a.settings.multiple?' multiple="multiple"':
"",' type="file" class="zui-upload-file" /></form>'].join(""));a.$form.addClass("zui-upload-form").bind("submit",function(h){if(!window.FormData||!window.FileList){a.$iframe.load(function(){a.$file.removeAttr("disabled");e.trigger("uploadcomplete",{file:a.$file,response:c(this).contents().find("html body").text()});a.$iframe.unbind()});c(this).attr("target","zui-upload-iframe-"+a.uid)}else{var g=window.FormData?new FormData:new n;window.FileList&&c.each(a.$file[0].files,function(i,j){g.append(a.settings.name,
j)});for(var k in a.settings.data)a.settings.data.hasOwnProperty(k)&&g.append(k,a.settings.data[k]);c.ajax({xhr:function(){var i=new window.XMLHttpRequest;i.upload&&i.upload.addEventListener("progress",function(j){e.trigger("uploadprogress",{file:a.$file,event:j})},false);i.addEventListener("progress",function(j){e.trigger("uploadprogress",{file:a.$file,event:j})},false);return i},url:a.settings.url,data:g,cache:false,contentType:false,processData:false,type:a.settings.method}).done(function(i){a.$file.removeAttr("disabled");
e.trigger("uploadcomplete",{file:a.$file,response:i})});return false}h.stopPropagation()}).appendTo(e);a.$file=a.$form.find("input[type='file']");a.$file.bind("change",function(){if(e.trigger("uploadchange",{file:c(this)}).data("result")!==false){a.fileList=this.files;a.settings.autoSubmit&&f._processUpload.call(f,b)}});if(!window.FormData||!window.FileList){a.$iframe=c('<iframe name="zui-upload-iframe-'+a.uid+'" id="zui-upload-iframe-'+a.uid+'"></iframe>').attr("src","javascript:false").addClass("zui-upload-iframe").hide().appendTo(b);
for(var l in a.settings.data)a.settings.data.hasOwnProperty(l)&&c("<input>",{type:"hidden",name:l,value:a.settings.data[l]}).appendTo(a.$form)}e.bind("uploadchange",function(h,g){c(this).data("result",true);a.settings.change!==null&&a.settings.change.call(b,h,g)}).bind("uploadsubmit",function(h,g){c(this).data("result",true);a.settings.submit!==null&&a.settings.submit.call(b,h,g)}).bind("uploadcomplete",function(h,g){a.settings.complete!==null&&a.settings.complete.call(b,h,g)}).bind("uploadprogress",
function(h,g){a.settings.progress!==null&&a.settings.progress.call(b,h,g)});c.data(b,"upload",a)},_processUpload:function(b){var d=this._getInst(b);if(!d)return false;if(c(b).trigger("uploadsubmit",{file:d.$file}).data("result")!==false){d.$form.submit();d.$file.attr("disabled","disabled")}},_destroyUpload:function(b){var d=this._getInst(b),e=c(b);if(!d)return false;d.$form.remove();d.$iframe.remove();e.removeClass("zui-upload").find(".zui-upload-label").remove();c.data(b,"upload",false)},_optionUpload:function(b,
d,e){var f=this._getInst(b);if(!f)return false;if(typeof d==="string")if(e)f.settings[d]=e;else return f.settings[d];else typeof d==="object"&&c.extend(f.settings,d);c.data(b,"upload",f)},_newInst:function(b){return{id:b[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:b,uid:Math.floor(Math.random()*99999999),isDisabled:false,settings:{}}},_getInst:function(b){try{return c.data(b,"upload")}catch(d){throw"Missing instance data for this upload";}}};c.fn.zinoUpload=function(b){var d=Array.prototype.slice.call(arguments,
1);if(typeof b=="string"&&b=="isDisabled")return c.zinoUpload["_"+b+"Upload"].apply(c.zinoUpload,[this[0]].concat(d));if(b=="option"&&arguments.length==2&&typeof arguments[1]=="string")return c.zinoUpload["_"+b+"Upload"].apply(c.zinoUpload,[this[0]].concat(d));return this.each(function(){typeof b=="string"?c.zinoUpload["_"+b+"Upload"].apply(c.zinoUpload,[this].concat(d)):c.zinoUpload._attachUpload(this,b)})};c.zinoUpload=new m;c.zinoUpload.version="1.5"})(jQuery);